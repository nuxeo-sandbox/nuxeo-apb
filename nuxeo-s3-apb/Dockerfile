FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IG51eGVvLXMzLWFwYgpkZXNjcmlwdGlvbjogUzMgYnVja2V0IGRl\
cGxveW1lbnQgaW4gT3BlbnNoaWZ0IGZvciBOdXhlbwpiaW5kYWJsZTogVHJ1ZQphc3luYzogb3B0\
aW9uYWwKdGFnczoKICAtIG51eGVvCiAgLSBzMwptZXRhZGF0YToKICBkaXNwbGF5TmFtZTogUzMg\
ZW52aXJvbm1lbnQgZm9yIE51eGVvCiAgaW1hZ2VVcmw6ICJodHRwczovL3d3dy5udXhlby5jb20v\
YXNzZXRzL2ltZ3MvbG9nbzM0MHg2MC5wbmciCiAgbG9uZ0Rlc2NyaXB0aW9uOgogICAgVGhpcyBE\
ZXBsb3lzIGFuIFMzIGNvbXBhdGlibGUgZW52aXJvbm1lbnQgdGhhdCBjYW4gYmUgdXNlZCB3aXRo\
IE51eGVvCiAgZGVwZW5kZW5jaWVzOiBbXQogIHByb3ZpZGVyRGlzcGxheU5hbWU6ICJOdXhlbyIK\
cGxhbnM6CiAgLSBuYW1lOiBtaW5pbwogICAgZGVzY3JpcHRpb246IFMzIGJ1Y2tldCBkZXBsb3ll\
ZCB3aXRoIE1pbmlvCiAgICBmcmVlOiB0cnVlCiAgICBtZXRhZGF0YToge30KICAgIHBhcmFtZXRl\
cnM6CiAgICAtIG5hbWU6IHByb2plY3RfbmFtZQogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0\
bGU6IFByb2plY3QgTmFtZQogICAgICBkZWZhdWx0OiBtaW5pbwogICAgICBkaXNwbGF5X2dyb3Vw\
OiBQcm9qZWN0IHByb3BlcnRpZXMKICAgIC0gbmFtZTogbWluaW9faW1hZ2UKICAgICAgdHlwZTog\
c3RyaW5nCiAgICAgIHRpdGxlOiBNaW5pbyBpbWFnZQogICAgICBkZWZhdWx0OiBtaW5pby9taW5p\
bwogICAgICBkaXNwbGF5X2dyb3VwOiBQcm9qZWN0IHByb3BlcnRpZXMKICAgIC0gbmFtZTogbWlu\
aW9faW1hZ2VfdmVyc2lvbgogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IEltYWdlIHZl\
cnNpb24KICAgICAgZGVmYXVsdDogIlJFTEVBU0UuMjAxOS0wMi0yNlQxOS01MS00NloiCiAgICAg\
IGRpc3BsYXlfZ3JvdXA6IFByb2plY3QgcHJvcGVydGllcwogICAgLSBuYW1lOiBtaW5pb19tb2Rl\
CiAgICAgIHRpdGxlOiBNb2RlCiAgICAgIGRlZmF1bHQ6ICdTdGFuZGFsb25lJwogICAgICB0eXBl\
OiBlbnVtCiAgICAgIGVudW06IFsnU3RhbmRhbG9uZScsICdEaXN0cmlidXRlZCddCiAgICAgIGRp\
c3BsYXlfZ3JvdXA6IFByb2plY3QgcHJvcGVydGllcwogICAgLSBuYW1lOiBtaW5pb19ub2Rlcwog\
ICAgICB0eXBlOiBpbnRlZ2VyCiAgICAgIHRpdGxlOiBOdW1iZXIgb2Ygbm9kZXMgKG11c3QgYmUg\
ZXZlbikKICAgICAgZGVmYXVsdDogJzQnCiAgICAgIGRpc3BsYXlfZ3JvdXA6IFByb2plY3QgcHJv\
cGVydGllcwogICAgLSBuYW1lOiBtaW5pb19zaXplCiAgICAgIHR5cGU6IGludGVnZXIKICAgICAg\
dGl0bGU6IFN0b3JhZ2Ugc2l6ZSBpbiBHYgogICAgICBkZWZhdWx0OiAnNScKICAgICAgZGlzcGxh\
eV9ncm91cDogUHJvamVjdCBwcm9wZXJ0aWVzCiAgICAtIG5hbWU6IG1pbmlvX3N0b3JhZ2VfY2xh\
c3MKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBTdG9yYWdlIGNsYXNzIChSV1ggZm9y\
IHN0YW5kYWxvbmUgYW5kIFJXTyBmb3IgZGlzdHJpYnV0ZWQpCiAgICAgIGRpc3BsYXlfZ3JvdXA6\
IFByb2plY3QgcHJvcGVydGllcwoKICAgIC0gbmFtZTogaW1hZ2VfcHVsbFBvbGljeQogICAgICBk\
ZWZhdWx0OiAnSWZOb3RQcmVzZW50JwogICAgICB0eXBlOiBlbnVtCiAgICAgIGVudW06IFsnSWZO\
b3RQcmVzZW50JywgJ0Fsd2F5cycsICdOZXZlciddCiAgICAgIHRpdGxlOiBJbWFnZSBwdWxsIHBv\
bGljeQogICAgICBkaXNwbGF5X2dyb3VwOiBDb250YWluZXIgU3BlY3MKICAgIC0gbmFtZTogcG9k\
QW5ub3RhdGlvbnMKICAgICAgZGVmYXVsdDogJ3t9JwogICAgICB0eXBlOiBzdHJpbmcKICAgICAg\
dGl0bGU6IEFubm90YXRpb25zIHRvIGJlIGFkZGVkIHRvIE1pbmlvIHBvZHMKICAgICAgZGlzcGxh\
eV90eXBlOiB0ZXh0YXJlYQogICAgICBkaXNwbGF5X2dyb3VwOiBDb250YWluZXIgU3BlY3MKICAg\
IC0gbmFtZTogc2VjdXJpdHlDb250ZXh0CiAgICAgIGRlZmF1bHQ6ICd7fScKICAgICAgdHlwZTog\
c3RyaW5nCiAgICAgIHRpdGxlOiBTZWN1cml0eSBjb250ZXh0IGZvciB0aGUgcG9kCiAgICAgIGRp\
c3BsYXlfdHlwZTogdGV4dGFyZWEKICAgICAgZGlzcGxheV9ncm91cDogQ29udGFpbmVyIFNwZWNz\
CiAgICAtIG5hbWU6IHJlc291cmNlcwogICAgICBkZWZhdWx0OiAneyJsaW1pdHMiOiB7ImNwdSI6\
ICIxIiwibWVtb3J5IjogIjUxMk1pIn0sInJlcXVlc3RzIjogeyJjcHUiOiAiMC41IiwibWVtb3J5\
IjogIjI1Nk1pIn19JwogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IFBvZCByZXNvdXJj\
ZSByZXF1ZXN0cyBhbmQgbGltaXRzCiAgICAgIGRpc3BsYXlfdHlwZTogdGV4dGFyZWEKICAgICAg\
ZGlzcGxheV9ncm91cDogQ29udGFpbmVyIFNwZWNzCgo="


ADD playbooks /opt/apb/actions

# Add our role into the ansible roles dir
ADD . /opt/ansible/roles/nuxeo-s3-apb/

RUN chmod -R g=u /opt/{ansible,apb}

USER apb