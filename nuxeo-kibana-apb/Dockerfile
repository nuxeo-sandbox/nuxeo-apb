FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IG51eGVvLWtpYmFuYS1hcGIKZGVzY3JpcHRpb246IEtpYmFuYSBp\
cyBhIGRhdGEgdmlzdWFsaXphdGlvbiBwbHVnaW4gZm9yIEVsYXN0aWNzZWFyY2gKYmluZGFibGU6\
IEZhbHNlCmFzeW5jOiBvcHRpb25hbAp0YWdzOgogIC0gbnV4ZW8KICAtIGtpYmFuYQptZXRhZGF0\
YToKICBkaXNwbGF5TmFtZTogIk51eGVvIEtpYmFuYSAoQVBCKSIKICBkZXBlbmRlbmNpZXM6IFtd\
CiAgaW1hZ2VVcmw6ICJodHRwczovL3d3dy5lbGFzdGljLmNvL2Fzc2V0cy9ibHQyODJhZTI0MjBl\
MzJmYzM4L2ljb24ta2liYW5hLWJiLnN2ZyIKICBwcm92aWRlckRpc3BsYXlOYW1lOiAiTnV4ZW8i\
CnBsYW5zOgogIC0gbmFtZTogZGVmYXVsdAogICAgZGVzY3JpcHRpb246IFRoaXMgcGxhbiBkZXBs\
b3lzIEtpYmFuYSB3aXRob3V0IHBlcnNpc3RlbnQgY2FjaGUKICAgIGZyZWU6IFRydWUKICAgIG1l\
dGFkYXRhOgogICAgICBkaXNwbGF5TmFtZTogRXBoZW1lcmFsIGluc3RhbGxhdGlvbiBieSBkZWZh\
dWx0CiAgICBkZWZhdWx0OiBUcnVlCiAgICBwYXJhbWV0ZXJzOgogICAgICAtIG5hbWU6IGFwcF9u\
YW1lCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgZGVmYXVsdDoga2liYW5hCiAgICAgICAg\
ZGVzY3JpcHRpb246IEtpYmFuYSBhcHBsaWNhdGlvbgogICAgICAgIHRpdGxlOiBBcHBsaWNhdGlv\
biBuYW1lCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSBuYW1lOiBraWJhbmFfbWVtb3J5\
X2xpbWl0CiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgZGVmYXVsdDogMjU2TWkKICAgICAg\
ICBkZXNjcmlwdGlvbjogTWVtb3J5IGxpbWl0IGZvciBLaWJhbmEgY29udGFpbmVyCiAgICAgICAg\
dGl0bGU6IE1lbW9yeSBsaW1pdAogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIC0gbmFtZTog\
a2liYW5hX2ltYWdlCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgdGl0bGU6IEtpYmFuYSBp\
bWFnZQogICAgICAgIGRlZmF1bHQ6IGRvY2tlci5lbGFzdGljLmNvL2tpYmFuYS9raWJhbmEtb3Nz\
CiAgICAgIC0gbmFtZToga2liYW5hX2ltYWdlX3ZlcnNpb24KICAgICAgICB0aXRsZTogVmVyc2lv\
bgogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVmYXVsdDogNi4zLjIKICAgICAgICB0\
eXBlOiBlbnVtCiAgICAgICAgZW51bTogWyI3LjYuMSIsIDYuMy4yIiwgIjUuNi45Il0KICAgICAg\
LSBuYW1lOiBraWJhbmFfc3RvcmFnZV9wbGFuCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAg\
dGl0bGU6IGVwaGVtZXJhbCBvciBwZXJzaXN0ZW50CiAgICAgICAgZGVzY3JpcHRpb246IFRha2Ug\
dGhlIGRlZmF1bHQgb3B0aW9uIGVwaGVtZXJhbCBzdG9yYWdlIG9yIGNob29zZSBwZXJzaXN0ZW50\
CiAgICAgICAgZGVmYXVsdDogZXBoZW1lcmFsCiAgICAgIC0gbmFtZTogZWxhc3RpY3NlYXJjaF9s\
YWJlbF9zZWxlY3RvcgogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIGRlZmF1bHQ6IGNvbXBv\
bmVudD1lbGFzdGljc2VhcmNoCiAgICAgICAgdGl0bGU6IEVTIExhYmVsIHNlbGVjdG9yCiAgICAg\
ICAgZGVzY3JpcHRpb246IExhYmVsIHNlbGVjdG9yIHRvIHVzZSBpbiBvcmRlciB0byBmaW5kIHRo\
ZSBFbGFzdGljc2VhcmNoIHNlcnZpY2UKICAgICAgLSBuYW1lOiBraWJhbmFfc2VjdXJlCiAgICAg\
ICAgdHlwZTogYm9vbGVhbgogICAgICAgIGRlZmF1bHQ6IHRydWUKICAgICAgICBkZXNjcmlwdGlv\
bjogQWxsb3cgYWNjZXNzIG9ubHkgdG8gT3BlblNoaWZ0IHVzZXJzIGhhdmluZyBhY2Nlc3MgdG8g\
dGhlIHNlcnZpY2UKICAgICAgICB0aXRsZTogU2VjdXJlZCBhY2Nlc3MK"

COPY playbooks /opt/apb/actions
# Add our role into the ansible roles dir
COPY roles /opt/ansible/roles/

RUN chmod -R g=u /opt/{ansible,apb}

USER apb
