FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IG51eGVvLWtpYmFuYS1hcGIKZGVzY3JpcHRpb246IEtpYmFuYSBp\
cyBhIGRhdGEgdmlzdWFsaXphdGlvbiBwbHVnaW4gZm9yIEVsYXN0aWNzZWFyY2ggCmJpbmRhYmxl\
OiBGYWxzZQphc3luYzogb3B0aW9uYWwKdGFnczoKICAtIG51eGVvCiAgLSBraWJhbmEKbWV0YWRh\
dGE6CiAgZGlzcGxheU5hbWU6ICJOdXhlbyBLaWJhbmEgKEFQQikiCiAgZGVwZW5kZW5jaWVzOiBb\
XQogIGltYWdlVXJsOiAiaHR0cHM6Ly93d3cuZWxhc3RpYy5jby9hc3NldHMvYmx0MjgyYWUyNDIw\
ZTMyZmMzOC9pY29uLWtpYmFuYS1iYi5zdmciCiAgcHJvdmlkZXJEaXNwbGF5TmFtZTogIk51eGVv\
IgpwbGFuczoKICAtIG5hbWU6IGRlZmF1bHQKICAgIGRlc2NyaXB0aW9uOiBUaGlzIHBsYW4gZGVw\
bG95cyBLaWJhbmEgd2l0aG91dCBwZXJzaXN0ZW50IGNhY2hlCiAgICBmcmVlOiBUcnVlCiAgICBt\
ZXRhZGF0YToKICAgICAgZGlzcGxheU5hbWU6IEVwaGVtZXJhbCBpbnN0YWxsYXRpb24gYnkgZGVm\
YXVsdAogICAgZGVmYXVsdDogVHJ1ZQogICAgcGFyYW1ldGVyczoKICAgICAgLSBuYW1lOiBhcHBf\
bmFtZQogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIGRlZmF1bHQ6IGtpYmFuYQogICAgICAg\
IGRlc2NyaXB0aW9uOiBLaWJhbmEgYXBwbGljYXRpb24KICAgICAgICB0aXRsZTogQXBwbGljYXRp\
b24gbmFtZQogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIC0gbmFtZToga2liYW5hX21lbW9y\
eV9saW1pdAogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIGRlZmF1bHQ6IDI1Nk1pCiAgICAg\
ICAgZGVzY3JpcHRpb246IE1lbW9yeSBsaW1pdCBmb3IgS2liYW5hIGNvbnRhaW5lcgogICAgICAg\
IHRpdGxlOiBNZW1vcnkgbGltaXQKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAtIG5hbWU6\
IGtpYmFuYV9pbWFnZQogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHRpdGxlOiBLaWJhbmEg\
aW1hZ2UKICAgICAgICBkZWZhdWx0OiBkb2NrZXIuZWxhc3RpYy5jby9raWJhbmEva2liYW5hLW9z\
cwogICAgICAtIG5hbWU6IGtpYmFuYV9pbWFnZV92ZXJzaW9uCiAgICAgICAgdGl0bGU6IFZlcnNp\
b24KICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6IDYuMy4yCiAgICAgICAg\
dHlwZTogZW51bQogICAgICAgIGVudW06IFsiNi4zLjIiLCAiNS42LjkiXQogICAgICAtIG5hbWU6\
IGtpYmFuYV9zdG9yYWdlX3BsYW4KICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICB0aXRsZTog\
ZXBoZW1lcmFsIG9yIHBlcnNpc3RlbnQKICAgICAgICBkZXNjcmlwdGlvbjogVGFrZSB0aGUgZGVm\
YXVsdCBvcHRpb24gZXBoZW1lcmFsIHN0b3JhZ2Ugb3IgY2hvb3NlIHBlcnNpc3RlbnQKICAgICAg\
ICBkZWZhdWx0OiBlcGhlbWVyYWwKICAgICAgLSBuYW1lOiBraWJhbmFfc2VjdXJlCiAgICAgICAg\
dHlwZTogYm9vbGVhbgogICAgICAgIGRlZmF1bHQ6IHRydWUKICAgICAgICBkZXNjcmlwdGlvbjog\
QWxsb3cgYWNjZXNzIG9ubHkgdG8gT3BlblNoaWZ0IHVzZXJzIGhhdmluZyBhY2Nlc3MgdG8gdGhl\
IHNlcnZpY2UKICAgICAgICB0aXRsZTogU2VjdXJlZCBhY2Nlc3MK"

COPY playbooks /opt/apb/actions
# Add our role into the ansible roles dir
COPY roles /opt/ansible/roles/

RUN chmod -R g=u /opt/{ansible,apb}

USER apb
