FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IG51eGVvLWFyZW5kZXItcHJldmlld2VyLWFwYgpkZXNjcmlwdGlv\
bjogQVJlbmRlciBQcmV2aWV3ZXIgZGVwbG95bWVudCBpbiBPcGVuc2hpZnQgZm9yIE51eGVvCmJp\
bmRhYmxlOiBUcnVlCmFzeW5jOiBvcHRpb25hbAp0YWdzOgogIC0gbnV4ZW8KICAtIGFyZW5kZXIK\
bWV0YWRhdGE6CiAgZGlzcGxheU5hbWU6IEFSZW5kZXIgUHJldmlld2VyIGVudmlyb25tZW50IGZv\
ciBOdXhlbwogIGltYWdlVXJsOiAiaHR0cHM6Ly93d3cubnV4ZW8uY29tL2Fzc2V0cy9pbWdzL2xv\
Z28zNDB4NjAucG5nIgogIGxvbmdEZXNjcmlwdGlvbjoKICAgIFRoaXMgRGVwbG95cyBhbiBBUmVu\
ZGVyIHByZXZpZXdlciBlbnZpcm9ubWVudCB0aGF0IGNhbiBiZSB1c2VkIHdpdGggTnV4ZW8KICBk\
ZXBlbmRlbmNpZXM6IFtdCiAgcHJvdmlkZXJEaXNwbGF5TmFtZTogIk51eGVvIgpwbGFuczoKICAt\
IG5hbWU6IGRlZmF1bHQKICAgIGRlc2NyaXB0aW9uOiBEZWZhdWx0IEFSZW5kZXIgcHJldmlld2Vy\
IGRlcGxveW1lbnQKICAgIGZyZWU6IHRydWUKICAgIG1ldGFkYXRhOiB7fQogICAgcGFyYW1ldGVy\
czoKICAgIC0gbmFtZTogcHJvamVjdF9uYW1lCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRs\
ZTogUHJvamVjdCBOYW1lCiAgICAgIGRlZmF1bHQ6IGFyZW5kZXIKICAgICAgZGlzcGxheV9ncm91\
cDogUHJvamVjdCBwcm9wZXJ0aWVzCgogICAgLSBuYW1lOiBwcmV2aWV3ZXJfbnV4ZW9fdXJsCiAg\
ICAgIGRlZmF1bHQ6ICdodHRwczovL251eGVvLnVybC9udXhlbycKICAgICAgdHlwZTogc3RyaW5n\
CiAgICAgIHRpdGxlOiBVcmwgb2YgdGhlIE51eGVvIGNsaWVudAogICAgICBkaXNwbGF5X2dyb3Vw\
OiBDbGllbnQgTnV4ZW8KICAgIC0gbmFtZTogcHJldmlld2VyX251eGVvX2NsaWVudF90aW1lb3V0\
CiAgICAgIGRlZmF1bHQ6IDYwCiAgICAgIHR5cGU6IG51bWJlcgogICAgICB0aXRsZTogVGltZW91\
dCBmb3IgdGhlIE51eGVvIENsaWVudAogICAgICBkaXNwbGF5X2dyb3VwOiBDbGllbnQgTnV4ZW8K\
ICAgIC0gbmFtZTogcHJldmlld2VyX2FyZW5kZXJfbWF4X3RyaWVzCiAgICAgIGRlZmF1bHQ6IDUK\
ICAgICAgdHlwZTogbnVtYmVyCiAgICAgIHRpdGxlOiBOdW1iZXIgb2YgcmV0cmllcyBmb3IgQVJl\
bmRlciBobWkgdG8gYXNrIGZvciBhIHJlbmRpdGlvbiBjYWxsCiAgICAgIGRpc3BsYXlfZ3JvdXA6\
IENsaWVudCBOdXhlbwogICAgLSBuYW1lOiBwcmV2aWV3ZXJfbnV4ZW9fb2F1dGhfc2VjcmV0CiAg\
ICAgIGRlZmF1bHQ6ICdPQVVUSDJfU0VDUkVUJwogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0\
bGU6IFNoYXJlZCBzZWNyZXQgZm9yIE9BdXRoMiBleGNoYW5nZQogICAgICBkaXNwbGF5X2dyb3Vw\
OiBDbGllbnQgTnV4ZW8KCiAgICAtIG5hbWU6IGFyZW5kZXJfcmVuZGl0aW9uX3NlcnZpY2VfbmFt\
ZQogICAgICBkZWZhdWx0OiBhcmVuZGVyLXBvb2wtMQogICAgICB0eXBlOiBzdHJpbmcKICAgICAg\
dGl0bGU6IE5hbWUgb3IgdGhlIHJlbmRpdGlvbiBzZXJ2aWNlIHRvIHVzZQogICAgICBkaXNwbGF5\
X2dyb3VwOiBBUmVuZGVyIFJlbmRpdGlvbiBCaW5kaW5nCgogICAgLSBuYW1lOiBhcmVuZGVyX3By\
ZXZpZXdlcl9pbWFnZQogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IEFSZW5kZXIgcHJl\
dmlld2VyIGltYWdlCiAgICAgIGRlZmF1bHQ6IGRvY2tlci1yZWdpc3RyeS5kZWZhdWx0LnN2Yzo1\
MDAwL2NvbW1vbi1pbmZyYS9hcmVuZGVyLXByZXZpZXdlcgogICAgICBkaXNwbGF5X2dyb3VwOiBD\
b250YWluZXIgSW1hZ2UKICAgIC0gbmFtZTogYXJlbmRlcl9wcmV2aWV3ZXJfaW1hZ2VfdmVyc2lv\
bgogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IEFSZW5kZXIgcHJldmlld2VyIGltYWdl\
IHZlcnNpb24KICAgICAgZGVmYXVsdDogIjEwLjIuMiIKICAgICAgZGlzcGxheV9ncm91cDogQ29u\
dGFpbmVyIEltYWdlCgogICAgLSBuYW1lOiBhcmVuZGVyX3ByZXZpZXdlcl9pbWFnZV9wdWxsX2V4\
aXN0aW5nX3NlY3JldAogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IE5hbWUgb2Ygc2Vj\
cmV0IHRvIHVzZSB0byBwdWxsIGltYWdlIChMZWF2ZSBlbXB0eSBpZiB5b3V0IHdhbnQgdG8gdXNl\
IHVzZXIvcGFzc3dvcmQpCiAgICAgIGRpc3BsYXlfZ3JvdXA6IENvbnRhaW5lciBJbWFnZQogICAg\
LSBuYW1lOiBhcmVuZGVyX3ByZXZpZXdlcl9pbWFnZV9wdWxsX2hvc3QKICAgICAgdHlwZTogc3Ry\
aW5nCiAgICAgIHRpdGxlOiBEb2NrZXIgcmVwb3NpdG9yeSB0byB1c2UgZm9yIHNlY3JldAogICAg\
ICBkZWZhdWx0OiBkb2NrZXItcmVnaXN0cnkuZGVmYXVsdC5zdmM6NTAwMAogICAgICBkaXNwbGF5\
X2dyb3VwOiBDb250YWluZXIgSW1hZ2UKICAgIC0gbmFtZTogYXJlbmRlcl9wcmV2aWV3ZXJfaW1h\
Z2VfcHVsbF91c2VybmFtZQogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IFVzZXJuYW1l\
IHRvIHVzZSB0byBwdWxsIHRoZSBEb2NrZXIgaW1hZ2UKICAgICAgZGVmYXVsdDogbnV4ZW8KICAg\
ICAgZGlzcGxheV9ncm91cDogQ29udGFpbmVyIEltYWdlCiAgICAtIG5hbWU6IGFyZW5kZXJfcHJl\
dmlld2VyX2ltYWdlX3B1bGxfcGFzc3dvcmQKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxl\
OiBQYXNzd29yZCB0byB1c2UgdG8gcHVsbCB0aGUgRG9ja2VyIGltYWdlCiAgICAgIGRpc3BsYXlf\
dHlwZTogcGFzc3dvcmQKICAgICAgZGlzcGxheV9ncm91cDogQ29udGFpbmVyIEltYWdlCgogICAg\
LSBuYW1lOiBwcmV2aWV3ZXJfaW1hZ2VfcHVsbFBvbGljeQogICAgICBkZWZhdWx0OiAnSWZOb3RQ\
cmVzZW50JwogICAgICB0eXBlOiBlbnVtCiAgICAgIGVudW06IFsnSWZOb3RQcmVzZW50JywgJ0Fs\
d2F5cycsICdOZXZlciddCiAgICAgIHRpdGxlOiBBUmVuZGVyIFByZXZpZXdlciBpbWFnZSBwdWxs\
IHBvbGljeQogICAgICBkaXNwbGF5X2dyb3VwOiBDb250YWluZXIgU3BlY3MKCiAgICAtIG5hbWU6\
IHBlcnNpc3RlbnRWb2x1bWVfc3RvcmFnZUNsYXNzCiAgICAgIGRlZmF1bHQ6ICdzaGFyZWQnCiAg\
ICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRsZTogU3RvcmFnZSBjbGFzc2UgbmFtZSAobXVzdCBi\
ZSBjYXBhYmxlIG9mIFJXWCkKICAgICAgZGlzcGxheV9ncm91cDogQ29udGFpbmVyIFNwZWNzCgog\
ICAgLSBuYW1lOiBwcmV2aWV3ZXJfcmVzb3VyY2VzCiAgICAgIGRlZmF1bHQ6ICd7ImxpbWl0cyI6\
IHsiY3B1IjogIjIiLCJtZW1vcnkiOiAiNEdpIn0sInJlcXVlc3RzIjogeyJjcHUiOiAiMSIsIm1l\
bW9yeSI6ICIzR2kifX0nCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRsZTogUHJldmlld2Vy\
IFBvZCByZXNvdXJjZSByZXF1ZXN0cyBhbmQgbGltaXRzCiAgICAgIGRpc3BsYXlfdHlwZTogdGV4\
dGFyZWEKICAgICAgZGlzcGxheV9ncm91cDogQ29udGFpbmVyIFNwZWNzCgogICAgLSBuYW1lOiBh\
cmVuZGVyX2F1dG9zY2FsaW5nX21pbgogICAgICBkZWZhdWx0OiAxCiAgICAgIHR5cGU6IG51bWJl\
cgogICAgICB0aXRsZTogQXV0b3NjYWxpbmcgTWluaW11bSByZXBsaWNhcwogICAgICBkaXNwbGF5\
X2dyb3VwOiBBdXRvc2NhbGluZwogICAgLSBuYW1lOiBhcmVuZGVyX2F1dG9zY2FsaW5nX21heAog\
ICAgICBkZWZhdWx0OiAxCiAgICAgIHR5cGU6IG51bWJlcgogICAgICB0aXRsZTogQXV0b3NjYWxp\
bmcgTWF4aW11bSByZXBsaWNhcwogICAgICBkaXNwbGF5X2dyb3VwOiBBdXRvc2NhbGluZwogICAg\
LSBuYW1lOiBhcmVuZGVyX2F1dG9zY2FsaW5nX3RhcmdldENQVQogICAgICBkZWZhdWx0OiA4MAog\
ICAgICB0eXBlOiBudW1iZXIKICAgICAgdGl0bGU6IEF1dG9zY2FsaW5nIFRhcmdldCBDUFUgVXNh\
Z2UgcGVyY2VudGFnZQogICAgICBkaXNwbGF5X2dyb3VwOiBBdXRvc2NhbGluZwoKICAgIC0gbmFt\
ZTogYXJlbmRlcl9wcmV2aWV3ZXJfZ3dfdGltZW91dF9pbl9zZWNvbmRzCiAgICAgIGRlZmF1bHQ6\
ICIxMjBzIgogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IEdhdGV3YXkgdGltZW91dAog\
ICAgICBkaXNwbGF5X2dyb3VwOiBPdGhlcnMKCiAgICAtIG5hbWU6IGFyZW5kZXJfcHJldmlld2Vy\
X21vbml0b3JpbmdfZW5hYmxlZAogICAgICBkZWZhdWx0OiBmYWxzZQogICAgICB0eXBlOiBib29s\
ZWFuCiAgICAgIGRpc3BsYXlfdHlwZTogY2hlY2tib3gKICAgICAgdGl0bGU6IEVuYWJsZSBNb25p\
dG9yaW5nIHN0YWNrCiAgICAgIGRpc3BsYXlfZ3JvdXA6IE1vbml0b3JpbmcKCiAgICAtIG5hbWU6\
IGFyZW5kZXJfcHJldmlld2VyX21vbml0b3JpbmdfZXNfc2VydmljZQogICAgICBkZWZhdWx0OiBh\
cmVuZGVyLW1vbml0b3ItZWxhc3RpY3NlYXJjaAogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0\
bGU6IE5hbWUgb2YgdGhlIEVTIHNlcnZpY2UgaW5zdGFuY2UKICAgICAgZGlzcGxheV9ncm91cDog\
TW9uaXRvcmluZwoKICAgIC0gbmFtZTogYXJlbmRlcl9wcmV2aWV3ZXJfbW9uaXRvcmluZ19raWJh\
bmFfc2VydmljZQogICAgICBkZWZhdWx0OiBhcmVuZGVyLW1vbml0b3Ita2liYW5hCiAgICAgIHR5\
cGU6IHN0cmluZwogICAgICB0aXRsZTogTmFtZSBvZiB0aGUgS2liYW5hIHNlcnZpY2UgaW5zdGFu\
Y2UKICAgICAgZGlzcGxheV9ncm91cDogTW9uaXRvcmluZwo="

ADD playbooks /opt/apb/actions

# Add our role into the ansible roles dir
ADD . /opt/ansible/roles/nuxeo-arender-apb/
ADD . /opt/ansible/roles/nuxeo-arender-previewer-apb/

RUN chmod -R g=u /opt/{ansible,apb}

USER apb